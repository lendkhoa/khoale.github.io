<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/TimeStyling.css" rel="stylesheet">

    <!-- include all compiled plugins (below or include individual files as needed) -->

    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.min.js"></script>ï»¿
    <script type="text/javascript" src="js/jspdf.min.js"></script>
    <title> Stop watch </title>
    <script type="text/javascript">

        var today = new Date();
        var dd = today.getDate();
        var mm = today.getMonth()+1; //January is 0!
        var yyyy = today.getFullYear();

        if(dd<10) {
            dd='0'+dd
        }

        if(mm<10) {
            mm='0'+mm
        }

        today = mm+'/'+dd+'/'+yyyy;

        var specialElementHandlers = {
            '#hidediv': function (element, renderer) {
                return true;
            }
        };

        function genPDF() {
            var doc = new jsPDF('p', 'mm', [297, 210]);
            doc.text( 20, 20, 'Tasks on: '+today);
            doc.fromHTML($('#laps').get(0), 20, 20, {
                'width':900,
                'elementHandlers':specialElementHandlers
            });
            doc.output('dataurlnewwindow');
        }
    </script>
</head>
<body>
<div class="container-fluid">
    <div id="header">
        <h1> Time Management </h1>
    </div>

    <div id="lap">
        <span id="laphour">00</span>:
        <span id="lapminute">00</span>:
        <span id="lapsecond">00</span>
    </div>

    <div id="timer">
        <span id="timerhour">00</span>:
        <span id="timerminute">00</span>:
        <span id="timersecond">00</span>
    </div>

    <div class="row" id="controlContainer">
        <div class="col-xs-2 col-xs-offset-4">
            <div id="start" class="controlButton"> Start </div>
            <div id="stop" class="controlButton"> Stop </div>
            <div id="resume" class="controlButton"> Resume</div>
        </div>
        <div class="col-xs-2">
            <div id="takeLap" class="controlButton"> Lap </div>
            <div id="reset" class="controlButton"> Reset </div>
        </div>
    </div>

    <div class="container-fluid" id="textfield">
        <a onclick="genPDF();" class="btn btn-default"> Generate pdf </a>
        <form>
            <input type="text" name="title" id="input" value="New task">
        </form>
    </div>

    <div id="laps">

    </div>

    <br/>
    <br/>
    <br/>
    <br/>
    <div class="panel-footer">
        <p> Photo Credit: Trung Vo </p>
    </div>
</div>

<script src="js/bootstrap.min.js"></script>
<script>
    $(document).ready(function () {
        //variables
        var mode = false;
        var counter = 0;
        var lapCounter = 0;
        var counterlap = 0;
        var action;
        var lapsNumber = 0;
        var beginning = 0;
        var duration = 0;
        var hr, min, sec, cs, laphr, lapmin, lapsec, lapcs, durhr, durmin, dursec;
        hr=min = sec =cs =laphr=lapmin=lapsec=durhr = durmin=dursec = 0;

        //on app load show start and lap buttons
        hideShowButton("#start", "#takeLap");
        //click on start button
        $("#start").click(function () {
            //show stop and lap buttons.
            hideShowButton("#stop", "#takeLap");
            mode = true;
            //start counter with a function
            countAction();
        });

        //click on stop button
        //show resume and reset buttons
        $("#stop").click(function(){
            hideShowButton("#resume", "#reset");
            //stop counter
            clearInterval(action);
        });

        //click on resume button
        $("#resume").click(function(){
            //show resume and reset buttons
            hideShowButton("#stop", "#takeLap");
            //start action
            countAction();
        });


        $("#reset").click(function(){
            location.reload();
        });

        //click on lapbutton
        $("#takeLap").click(function () {
            if (mode){
                clearInterval(action);
                lapCounter = 0;
                counterlap = 0;
                addLap();
                countAction();
            }
        });

        function hideShowButton(x, y){
            $(".controlButton").hide();
            $(x).show();
            $(y).show();
        }

        function countAction(){
            action = window.setInterval(function(){
                counter++;
                if (counter == 100*60*100*100){
                    counter = 0;
                }
                lapCounter++;
                if (lapCounter == 100*60*100*100){
                    lapCounter = 0;
                }
                updateTime();
            }, 1000);
        }

        function updateTime() {
            hr = Math.floor(counter/ 3600);
            min = Math.floor((counter%3600)/60);
            sec = Math.floor(counter%60);

            $('#timerhour').text(format(hr));
            $('#timerminute').text(format(min));
            $('#timersecond').text(format(sec));
            $('#timercentisecond').text(format(cs));

            laphr = Math.floor(lapCounter/ 3600);
            lapmin =  Math.floor((lapCounter % 3600)/60);
            lapsec = Math.floor(lapCounter%60);

            $('#laphour').text(format(laphr));
            $('#lapminute').text(format(lapmin));
            $('#lapsecond').text(format(lapsec));

        }

        function updateDuration(duration){
            durhr = Math.floor(duration/ 3600);
            console.log('durhr: '+durhr +' duration: '+duration);
            duration = duration % 3600;
            durmin = Math.floor(duration/60);
            console.log('durmin: '+ durmin +' duration: '+duration);
            dursec = Math.floor (duration%60);
            console.log('dursec: '+ dursec +' duration: '+duration);
        }

        function format(number){
            if(number < 10){
                return '0'+number;
            } else {
                return number;
            }
        }

        function addLap(){

            //calculate duration
            duration = counter - beginning;
            beginning = counter;
            updateDuration(duration);

            lapsNumber++;
            var value = $("#input").val();
            var myLap = '' +
                    '<div id="result">' +
                    '<div id="lapHeader">' +
                    lapsNumber + '.  '+ value + ' |' + '&nbsp'+'Duration'+ '&nbsp'+
                    '<span>' +format(durhr) +'</span>'+ ' hr '+
                    '<span>' +format(durmin) +'</span>'+ ' min '+
                    '<span>' +format(dursec) +'</span>'+ ' s ' +
                    '</div>' +

                    '<div id="lapNumber">' +
                    '<span>' +format(hr) +'</span>'+ ':'+
                    '<span>' +format(min) +'</span>'+ ':'+
                    '<span>' +format(sec) +'</span>'+
                    '</div>'+
                    '</div>';
            $(myLap).prependTo("#laps");
            $("input").val('Enter your task');
        }
    });
</script>

</body>
</html>